# 用户中心项目部署与上线

补充：serve命令，相当于在本地启动了一个服务器(将个人电脑当作服务器使用)，类似于nginx服务器，但是只能用于开发环境。


前置知识：
    多环境： 同一套代码出于不同的目的，在不同的环境下运行，例如：开发环境、测试环境、生产环境等。
    多环境配置：同一套代码在不同环境下有不同的配置，例如：开发环境、测试环境、生产环境等。
    多环境作用：
            1. 每个环境之间相互独立
            2. 方便测试，例如：开发环境可以随时修改代码，而不会影响生产环境的运行。
            3. 方便部署，例如：可以将项目部署到不同的服务器上，例如：开发环境部署到本地服务器，测试环境部署到测试服务器，生产环境部署到生产服务器。
            4. 可以对项目进行优化：例如开发环境中的一些依赖项可以不打包到线上的项目中；
                                      本地开发环境中的日志文件级别是DEBUG，而生产环境中的日志文件级别是INFO。
            5. 项目的参数/环境可以调整：最大堆内存、初始堆内存、JVM参数等。

1. 多环境分类：
    1. 本地环境(localhost)
    2. 开发环境(所有开发人员都可以访问的一个内网环境，远程开发)
    3. 测试环境：可以是开发/测试/产品环境；与开发环境不同，使用独立的数据库、独立的服务器。
    4. 预发布环境：与正式环境一致，使用正式环境的数据库，查出更多问题。
    5. 正式环境(生产环境)：上线、公开对外访问的环境，尽量不要改动。
    6. 沙箱环境(实验环境)：测试环境的一种，验证新功能、测试单个功能。主要是为了做实验。

2.实现方式：
    1. 原生方式：
        * 直接将项目部署到服务器上，例如：使用nginx反向代理，将请求转发到项目的端口上。
        * 配置项目的环境变量，例如：数据库连接字符串、接口地址等。
        * 启动项目，例如：使用node命令启动项目，或者使用pm2等进程管理工具启动项目。
    2. 宝塔Linux:
    3. Docker容器:
    4. 容器平台：

## 前端多环境实战
    1 请求地址:
        * 开发环境: localhost:8000
        * 线上环境: http://www.xxx.com
  
    项目启动时选择开发环境/线上环境的时机：
    类似如下方法：
    startFront(env){
        if(env === 'prod'){
            // 取消注释
            // 项目优化
            // 修改请求地址
        }esle{
            // 保持项目不变
        }
    }
    -----由于该项目使用了umi框架，该前端项目在build时，会自动传入env==production，因此无需手动修改。
    2.启动方式：
        开发环境: npm run start(本地启动)
        线上环境: npm run build(项目构建打包上线)
    
    3. 项目配置不同
       当前umi的配置文件时config/config.ts，该文件会根据环境的不同而不同。
       配置文件的后缀来区分不同的环境。
       1. 公共配置：config/config.ts
       2. 线上环境：config/config.prod.ts
       3. 开发环境: config/config.dev.ts







## 后端多环境实战
项目配置不同
      application.yml
      1. 公共配置：application.yml
      2. 线上环境：application-prod.yml
      3. 开发环境: application-dev.yml

主要修改如下:
    1. 数据库地址
    2. 缓存地址
    3. 消息队列地址
    4. 日志文件路径
    5. 项目端口号
    6. ...

可以在项目启动时传入环境变量：
    java -jar xxx.jar --spring.profiles.active=prod(进入target目录执行命令)

## 项目部署

### 原始部署
    1.前端
        Web服务器：nginx
            * 安装nginx：
                I. 使用系统自带的软件包管理器快速安装，例如：yum install nginx
                II. 官网安装：https://nginx.org/en/download.html。
                    * 使用 curl -o nginx-1.29.3.tar.gz https://nginx.org/download/nginx-1.29.3.tar.gz 下载文件
                    * 使用tar -zxvf nginx-1.20.1.tar.gz(刚刚从官网下载的文件)解压，然后进入nginx目录执行./configure --prefix=/usr/local/nginx，make, make install


            * 

    2.后端(过于复杂)

### 宝塔Linux部署
    可视化部署，更方便的管理服务器，安装软件

### Docker容器部署(Docker可以理解为软件安装包，类似于exe安装包)
    将项目依赖的环境(java、nginx、mysql等)打包成一个镜像，然后运行这个镜像。
    镜像便于分发与迁移。
    再次运行项目时，就无需使用繁琐复杂的命令了。而是直接下载镜像，然后运行镜像即可。

    DockerFile: 类似于Docker镜像的配置文件，用于描述如何构建一个Docker镜像。
                分别给前后端项目都指定对应的DockerFile。(去网上搜索对应的dockerfile模板即可，例如：前端项目的Dockerfile模板为nginx:1.20-alpine，后端项目的Dockerfile模板为openjdk-8-alpine)
